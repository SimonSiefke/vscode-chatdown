fileTypes: [chat]
name: Chatdown
patterns:
  - { include: "#frontMatter" }
  - { include: "#chat" }
repository:
  frontMatter:
    patterns:
      - match: "^(user|bot)(=)\\s*([a-zA-Z]+)\\s*$"
        name: meta.frontmatter.chatdown
        captures:
          1:
            name: meta.frontmatter.key.chatdown
            patterns:
              - include: "#frontmatter.key"
          2:
            name: meta.frontmatter.separator.chatdown
          3:
            name: meta.frontmatter.value.chatdown
            patterns:
              - include: "#frontmatter.value"
      - match: "^(users)(=)\\s*([a-zA-Z]+(,\\s*[a-zA-Z]+)*)\\s*$"
        name: meta.frontmatter.chatdown
        captures:
          1:
            name: meta.frontmatter.key.chatdown
            patterns:
              - include: "#frontmatter.key"
          2:
            name: meta.frontmatter.separator.chatdown
            patterns:
              - include: "#frontmatter.separator"
          3:
            name: meta.frontmatter.value.chatdown
            patterns:
              - include: "#frontmatter.value"
  frontmatter.key:
    patterns:
      - match: ".*"
        name: variable.other
  frontmatter.separator:
    patterns:
      - match: ".*"
        name: keyword.operator.assignment
  frontmatter.value:
    patterns:
      - match: "[a-zA-Z]+"
        name: string.unquoted
      - match: ","
        name: punctuation.separator.chatdown

  chat:
    patterns:
      - begin: "^([a-zA-Z]+)(:)"
        end: "^(?=[a-zA-Z]+:.*)"
        name: meta.chat
        beginCaptures:
          1:
            name: meta.chat.participant
            patterns:
              - include: "#chat.participant"
          2:
            name: chat.separator
        endCaptures:
          0:
            name: markup.italic
        patterns:
          - match: ".*"
            name: meta.chat.text
            include: "#chat.text"

  chat.participant:
    patterns:
      - match: ".*"
        name: markup.bold
  chat.text:
    patterns:
      - match: ".*"
        name: meta.paragraph.markdown

      # - match: "^(bot|[a-zA-Z]+)(:)\\s*([^:]*)$"
      #   name: meta.chat
      #   captures:
      #     1:
      #       name: meta.chat.key
      #       patterns:
      #         - include: "#chat.key"
      #     2:
      #       name: meta.chat.separator
      #     3:
      #       name: meta.chat.value
      #       patterns:
      #         - include: "#chat.value"
  chat.key:
    patterns:
      - match: ".*"
        name: markup.italic
  chat.value:
    patterns:
      - match: ".*"
        name: markup.italic
  # meta:
  #   patterns:
  #     - match: "a-zA-Z"
  #       name: markup.italic
  # - include: "#meta"
  # while: "(?=[a-zA-Z]+\\s*=\\s*[a-zA-Z]+)" # new line
  # end: "^$"
  # end: "^\\s*(?=([a-zA-Z]+=[a-zA-Z]+)*)" # new line
  # while: "(?=\\s+)|(?=^$)" # new line
  # meta:
  #   patterns:
  #     - match: "^(users?|bot)"
  #       name: "entity.name.tag.chatdown"
  #     - match: "="
  #       name: "punctuation.separator.key-value.mapping.chatdown"
  #     - match: "[^a-zA-Z\\s]+"
  #       name: "invalid.illegal.expected-value.chatdown"
  #     - match: "[a-zA-Z]+"
  #       name: "string.unquoted.chatdown"
  # chat:
  #   patterns:
  #     - match: "^[a-zA-Z]+(?:(->)([a-zA-Z]+))?"
  #       captures:
  #         0:
  #           name: "entity.name.tag.chatdown"
  #         1:
  #           name: keyword.operator.to.chatdown
  #         2:
  #           name: "entity.name.tag.chatdown"
  #     - match: "([^:]+)(?=:)"
  #       name: invalid.illegal.expected-colon.chatdown
  #     - match: ":"
  #       name: "punctuation.separator.key-value.mapping.chatdown"
  #     - match: ".*$"
  #       name: "meta.structure.dictionary.value.json"
  #       captures:
  #         0:
  #           patterns:
  #             - include: "#value"
  # value:
  #   patterns:
  #     - begin: "\\["
  #       end: "\\]"
  #       beginCaptures:
  #         0:
  #           name: "punctuation.definition.array.begin.chatdown"
  #       endCaptures:
  #         0:
  #           name: "punctuation.definition.array.end.chatdown"
  #       name: "meta.structure.array"
  #       patterns:
  #         - include: "#insideArrayKeyValue"
  # insideArrayKeyValue:
  #   patterns:
  #     - match: "(Typing|Delay|ConversationUpdate)"
  #       name: "constant.language.chatdown"
  #     - match: "="
  #       name: punctuation.separator.key-value.mapping.chatdown
  #     - match: "\\w*"
  #       name: "meta.structure.dictionary.value.chatdown"
  #       captures:
  #         0:
  #           patterns:
  #             - include: "#number"
  #             - include: "#string"
  # number:
  #   patterns:
  #     - match: "(?<!\\w)(?:(0|[1-9]\\d*))"
  #       name: constant.numeric.chatdown
  # string:
  #   patterns:
  #     - match: "[a-zA-Z\\d]+"
  #       name: "string.unquoted.chatdown"
scopeName: source.chatdown
